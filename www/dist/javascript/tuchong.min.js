!function(o,e){"use strict";function i(e,i,n,c,a,l,r,s,d,u){function g(e,i){function n(o){t&&t(o),r.alert(o,"获取推送权限失败...","知道了")}var a={badge:"true",sound:"true",alert:"true"};c.register(a).then(function(n){t&&t("Push service signup success, token: %s",n);var c={};return c.deviceType=e.platform?e.platform.toLowerCase():"ios","ios"===c.deviceType&&(c.deviceToken=n),"android"===c.deviceType&&(c.installationId=n),o.forEach(["model","uuid","version"],function(o){e[o]&&(c[o]=e[o])}),i(c)},n)}function h(o,e){return e.collectionId?void u.go("collection",{id:e.collectionId}):void r.alert(e.alert,"收到通知","知道了")}function f(o,e,i,n){t&&t("%s => %s",n.name||"init",e.name);var c="home"===e.name&&n.name,l="home"===n.name&&"collection"===e.name,r="collection-single"===n.name&&"collection"===e.name;if((c||l||r)&&!l){var d=c?localStorage.lastSlideIndexHome:localStorage.lastSlideIndexCollection;d||(d=0),d=parseInt(d),t&&t("Going back to %s",d),a(function(){s.slide(d)},300)}}localStorage.lastSlideIndexHome&&localStorage.removeItem("lastSlideIndexHome"),d.$on("$stateChangeSuccess",f),d.$on("pushNotificationReceived",h),e.ready(function(){var o=i.getDevice(),e=n.getNetwork();t&&(t(o),t(e)),"wifi"!==e&&"Connection.WIFI"!==e&&r.alert("检查到当前使用的网络不是 Wi-Fi，除非您使用 3G/4G 网络，图虫日报不建议在非 Wi-Fi 网络下加载大图","ヾ(´ρ｀)〃 流量提示","继续浏览"),g(o,function(o){function e(o){t&&t(o)}function i(o){t&&t(o)}t&&t(o),l.installations.post(o,e,i)})})}function n(o,e,i,n,t,c){n.config(appConfigs.avoscloud),o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"],o.defaults.headers.common[c||"tuchong-daily-token"]=t,e.state("home",{url:"/",templateUrl:"templates/home.html",controller:"home"}).state("collection",{url:"/collection/:id",templateUrl:"templates/collection.html",controller:"collection"}).state("collection-single",{url:"/images?uri",templateUrl:"templates/single.html",controller:"collection-single"}),i.otherwise("/")}var t;if(!o)throw new Error("Angular.js is required");e&&(t=e("tuchong-daily:app")),o.module("tuchong-daily",["ionic","avoscloud","ngResource","ngCordova"]).constant("API_TOKEN",appConfigs.API_TOKEN).constant("API_SERVER",appConfigs.API_SERVER).constant("API_TOKEN_KEY","tuchong-daily-token").constant("TC_SERVER","http://tuchong.com/api/").config(["$httpProvider","$stateProvider","$urlRouterProvider","avoscloudProvider","API_TOKEN","API_TOKEN_KEY",n]).run(["$ionicPlatform","$cordovaDevice","$cordovaNetwork","$cordovaPush","$timeout","avoscloud","$cordovaDialogs","$ionicSlideBoxDelegate","$rootScope","$state",i])}(window.angular,window.debug),function(o,e){"use strict";function i(o,e){this.loading={show:function(e){var i={};return i.template=e,o.show(i)},hide:function(){return o.hide()}},this.alert=function(o,i){e.alert(o).then(i)},this.confirm=function(o,i){e.confirm(o).then(i)},this.popup=function(o,i){e.show(o).then(i)}}var n;if(!o)throw new Error("Angular.js is required");e&&(n=e("tuchong-daily:UI")),o.module("tuchong-daily").service("UI",["$ionicLoading","$ionicPopup",i])}(window.angular,window.debug),function(o,e){"use strict";function i(e,i,n,t){var c=this;c.tuchong={};var a={hot:"/daily",post:"/post"},l={post:"post/get-post-and-images"},r={post:{method:"POST"},update:{method:"PUT"},put:{method:"PUT"}};c.cache={},o.forEach(a,function(o,n){c[n]=e(i+o,null,r)}),o.forEach(l,function(o,i){c.tuchong[i]=e(t+o,null,r)}),c.save=function(o,e){c.cache[o]=e},c.findById=function(e){var i=null;return e&&c.cache.collections?(o.forEach(c.cache.collections,function(o){o.postId===e&&(i=o)}),i):i}}var n;if(!o)throw new Error("Angular.js is required");e&&(n=e("tuchong-daily:Store")),o.module("tuchong-daily").service("Store",["$resource","API_SERVER","API_TOKEN","TC_SERVER",i])}(window.angular,window.debug),function(o,e){"use strict";function i(o,e){function i(o,i){function t(e){if(window.Wechat){var t=i.title,c=o||null,a=i.site&&i.site.description?i.site.description:"";c&&c.excerpt&&(t+=" - "+c.excerpt),i&&i.author&&i.author.name&&(t+=" @"+i.author.name),a+=" 图虫日报，精选每日图虫热门图片。",Wechat.share({message:{title:t,description:a,thumb:c?c.uri_grid+".jpg":"http://ww2.sinaimg.cn/large/61ff0de3gw1emj19ju7p4j2030030745.jpg",media:{type:Wechat.Type.WEBPAGE,webpageUrl:i.url}},scene:e},function(){n&&n("Shared !")},function(o){n&&n(o)})}}var c={};c.buttons=[],c.buttons.push({text:'<i class="icon ion-at"></i> 分享给微信小伙伴'},{text:'<i class="icon ion-chatbubbles"></i> 分享到微信朋友圈'},{text:'<i class="icon ion-star"></i> 添加到微信收藏夹'}),c.titleText="与朋友们分享好图",c.cancelText="算了",c.buttonClicked=t,e.show(c)}this.popup=i}var n;if(!o)throw new Error("Angular.js is required");e&&(n=e("tuchong-daily:Share")),o.module("tuchong-daily").service("share",["$ionicLoading","$ionicActionSheet",i])}(window.angular,window.debug),function(o,e){"use strict";function i(o,e){function i(o){return a.cache[o]?a.cache[o]:[]}function t(i,t,l,r){function s(){n&&n("Image loaded: %s",u+".jpg"),t.backgrounds[i]=u,t.$apply(),t.slidesReady||(t.slidesReady=!0);var e="home"===l?l:r;a.cache[e]=t.backgrounds,o.loading.hide()}function d(){o.loading.show("图片加载失败，请稍后再试试...")}if(void 0!==i&&null!==i&&!isNaN(i)){if(t.backgrounds[i])return n&&n("Reading image from cache"),t.slidesReady||(t.slidesReady=!0),o.loading.hide();if(!t.collections&&!t.images)return o.loading.show("图片加载失败，请稍后再试试.."),void e(o.loading.hide,400);o.loading.show('<i class="icon ion-loading-c"></i> 图片加载中...');var u="home"===l?t.collections[i].images[0].uri:t.images[i].uri;c(u,s,d)}}function c(o,e,i){var n=new Image;n.onload=e,n.onerror=i,n.src=o+".jpg",n=null}var a=this;this.load=t,this.loadCache=i,this.cache={}}var n;if(!o)throw new Error("Angular.js is required");e&&(n=e("tuchong-daily:ImageLoader")),o.module("tuchong-daily").service("imageLoader",["UI","$timeout",i])}(window.angular,window.debug),function(o,e,i){"use strict";function n(e,n,c,a,l,r,s,d,u,g){function h(o){function e(e){return e.collections?(t&&t("Reading fresh collections (%s)",e.collections.length),f(e.collections,!0),c.save("collections",e.collections),void(o&&o())):a.loading.show('<i class="icon ion-close-circled"></i> 网络连接失败...请稍后再试')}function i(){a.loading.show('<i class="icon ion-close-circled"></i> 网络连接失败...请稍后再试'),o&&o()}c.hot.get({},e,i)}function f(n,t){var c=i.lastSlideIndexHome,a=!c||parseInt(c)<=3;e.collections=t?o.copy(n).splice(0,3):o.copy(n).splice(0,a?3:parseInt(c)+1),d.load(0,e,"home"),l.update()}function m(o){isNaN(o)&&(o=0),t&&t("Switching to slide: [%s]",o),d.load(o,e,"home"),!e.collections[o+1]&&c.cache.collections[o+1]&&e.collections.push(c.cache.collections[o+1]),i.lastSlideIndexHome=o,t&&t("Set lastSlideIndexHome to %s",o),l.update()}function p(o,e){var i=e>1;return i?n.go("collection",{id:o}):(a.loading.show('<i class="icon ion-information-circled"></i> 这个相册只有一张图'),void r(a.loading.hide,400))}return e.go=p,e.share=g.popup,e.updateSlides=m,e.backgrounds=d.loadCache("home"),a.loading.show('<i class="icon ion-refreshing"></i> 努力加载中...'),c.cache.collections?f(c.cache.collections):void h()}var t;if(!o)throw new Error("Angular.js is required");e&&(t=e("tuchong-daily:Controller:Home")),o.module("tuchong-daily").controller("home",["$scope","$state","Store","UI","$ionicSlideBoxDelegate","$timeout","$rootScope","imageLoader","$cordovaDialogs","share",n])}(window.angular,window.debug,window.localStorage),function(o,e,i){"use strict";function n(e,n,t,a,l,r,s,d,u,g){function h(n,t){var c=i.lastSlideIndexCollection,r=!c||parseInt(c)<=3;e.post=n.post,e.images=t?o.copy(n.images).splice(0,3):o.copy(n.images).splice(0,r?3:parseInt(c)+1),s.load(0,e,"collection",l.id),a.update()}function f(o){c&&c("Switching to slide: [%s]",o),s.load(o,e,"collection",l.id),i.lastSlideIndexCollection=o,c&&c("Set lastSlideIndexCollection to %s",o),!e.images[o+1]&&v.images[o+1]&&e.images.push(v.images[o+1]),a.update()}function m(o){var e="right"===o?"toggleRight":"toggleLeft";d[e]()}function p(){var o=i.lastSlideIndexCollection?parseInt(i.lastSlideIndexCollection):0;return e.images&&e.images[o]?void r.go("collection-single",{uri:e.images[o].uri}):(t.loading.show('<i class="icon ion-information-circled"></i> 啊喔，找不到大图了'),void g(t.loading.hide,500))}e.toggle=m,e.share=u.popup,e.viewLarge=p,e.updateSlides=f,e.backgrounds=s.loadCache(l.id);var v=n.findById(l.id);return v?void h(v):void n.post.get({postId:l.id},function(o){c&&c(o),v=o,h(o,!0)},function(o){c&&c(o),r.go("home")})}function t(o,e,i,n){function t(o,e){return e.collectionId?void i.go("collection",{id:e.collectionId}):void n.alert(e.alert,"收到通知","知道了")}return e.uri?(o.uri=e.uri,void o.$on("pushNotificationReceived",t)):i.go("home")}var c;if(!o)throw new Error("Angular.js is required");e&&(c=e("tuchong-daily:Controller:Collection")),o.module("tuchong-daily").controller("collection",["$scope","Store","UI","$ionicSlideBoxDelegate","$stateParams","$state","imageLoader","$ionicSideMenuDelegate","share","$timeout","$cordovaDialogs",n]).controller("collection-single",["$scope","$stateParams","$state","$cordovaDialogs",t])}(window.angular,window.debug,window.localStorage);
//# sourceMappingURL=tuchong.min.js.map