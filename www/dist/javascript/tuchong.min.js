!function(o,e){"use strict";function i(o,e,i,t,c,l,a,r){function s(o,e){function t(o){n&&n(o),l.alert("(¬_¬)ﾉ 请手动在 设置 > 通知 启用推送","获取推送权限失败...","知道了")}var c={badge:"true",sound:"true",alert:"true"};i.register(c).then(function(i){n&&n("Push service signup success, token: %s",i);var t={};return t.deviceType=o.platform?o.platform.toLowerCase():"ios","ios"===t.deviceType&&(t.deviceToken=i),"android"===t.deviceType&&(t.installationId=i),e(t)},t)}function d(o,e,i,c){n&&n("%s => %s",c.name||"init",e.name);var l="home"===e.name&&c.name,r="home"===c.name&&"collection"===e.name,s="collection-single"===c.name&&"collection"===e.name;if((l||r||s)&&!r){var d=l?localStorage.lastSlideIndexHome:localStorage.lastSlideIndexCollection;d||(d=0),d=parseInt(d),n&&n("Going back to %s",d),t(function(){a.slide(d)},300)}}localStorage.lastSlideIndexHome&&localStorage.removeItem("lastSlideIndexHome"),r.$on("$stateChangeSuccess",d),o.ready(function(){var o=e.getDevice();n&&n(o),s(o,function(o){function e(o){n&&n(o)}function i(o){n&&n(o)}n&&n(o),c.installations.post(o,e,i)}),window.StatusBar&&StatusBar.styleDefault()})}function t(o,e,i,t,n,c){t.config(appConfigs.avoscloud),o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"],o.defaults.headers.common[c||"tuchong-daily-token"]=n,e.state("home",{url:"/",templateUrl:"templates/home.html",controller:"home"}).state("collection",{url:"/collection/:id",templateUrl:"templates/collection.html",controller:"collection"}).state("collection-single",{url:"/images?uri",templateUrl:"templates/single.html",controller:"collection-single"}),i.otherwise("/")}var n;if(!o)throw new Error("Angular.js is required");e&&(n=e("tuchong-daily:app")),o.module("tuchong-daily",["ionic","avoscloud","ngResource","ngCordova"]).constant("API_TOKEN",appConfigs.API_TOKEN).constant("API_SERVER",appConfigs.API_SERVER).constant("API_TOKEN_KEY","tuchong-daily-token").constant("TC_SERVER","http://tuchong.com/api/").config(["$httpProvider","$stateProvider","$urlRouterProvider","avoscloudProvider","API_TOKEN","API_TOKEN_KEY",t]).run(["$ionicPlatform","$cordovaDevice","$cordovaPush","$timeout","avoscloud","$cordovaDialogs","$ionicSlideBoxDelegate","$rootScope",i])}(window.angular,window.debug),function(o,e){"use strict";function i(o,e){this.loading={show:function(e){var i={};return i.template=e,o.show(i)},hide:function(){return o.hide()}},this.alert=function(o,i){e.alert(o).then(i)},this.confirm=function(o,i){e.confirm(o).then(i)},this.popup=function(o,i){e.show(o).then(i)}}var t;if(!o)throw new Error("Angular.js is required");e&&(t=e("tuchong-daily:UI")),o.module("tuchong-daily").service("UI",["$ionicLoading","$ionicPopup",i])}(window.angular,window.debug),function(o,e){"use strict";function i(e,i,t,n){var c=this;c.tuchong={};var l={hot:"/daily",post:"/post"},a={post:"post/get-post-and-images"},r={post:{method:"POST"},update:{method:"PUT"},put:{method:"PUT"}};c.cache={},o.forEach(l,function(o,t){c[t]=e(i+o,null,r)}),o.forEach(a,function(o,i){c.tuchong[i]=e(n+o,null,r)}),c.save=function(o,e){c.cache[o]=e},c.findById=function(e){var i=null;return e&&c.cache.collections?(o.forEach(c.cache.collections,function(o){o.postId===e&&(i=o)}),i):i}}var t;if(!o)throw new Error("Angular.js is required");e&&(t=e("tuchong-daily:Store")),o.module("tuchong-daily").service("Store",["$resource","API_SERVER","API_TOKEN","TC_SERVER",i])}(window.angular,window.debug),function(o,e){"use strict";function i(o,e){function i(o,i){function n(e){if(window.Wechat){var n=i.title,c=o||null,l=i.site&&i.site.description?i.site.description:"";c&&c.excerpt&&(n+=" - "+c.excerpt),i&&i.author&&i.author.name&&(n+=" @"+i.author.name),l+=" 图虫日报，精选每日图虫热门图片。",Wechat.share({message:{title:n,description:l,thumb:c?c.uri_grid+".jpg":"http://ww2.sinaimg.cn/large/61ff0de3gw1emj19ju7p4j2030030745.jpg",media:{type:Wechat.Type.WEBPAGE,webpageUrl:i.url}},scene:e},function(){t&&t("Shared !")},function(o){t&&t(o)})}}var c={};c.buttons=[],c.buttons.push({text:'<i class="icon ion-at"></i> 分享给微信小伙伴'},{text:'<i class="icon ion-chatbubbles"></i> 分享到微信朋友圈'},{text:'<i class="icon ion-star"></i> 添加到微信收藏夹'}),c.titleText="与朋友们分享好图",c.cancelText="算了",c.buttonClicked=n,e.show(c)}this.popup=i}var t;if(!o)throw new Error("Angular.js is required");e&&(t=e("tuchong-daily:Share")),o.module("tuchong-daily").service("share",["$ionicLoading","$ionicActionSheet",i])}(window.angular,window.debug),function(o,e){"use strict";function i(o,e){function i(o){return l.cache[o]?l.cache[o]:[]}function n(i,n,a,r){function s(){t&&t("Image loaded: %s",u+".jpg"),n.backgrounds[i]=u,n.$apply(),n.slidesReady||(n.slidesReady=!0);var e="home"===a?a:r;l.cache[e]=n.backgrounds,o.loading.hide()}function d(){o.loading.show("图片加载失败，请稍后再试试...")}if(void 0!==i&&null!==i&&!isNaN(i)){if(t&&n.backgrounds[i])return t&&t("Reading image from cache"),n.slidesReady||(n.slidesReady=!0),o.loading.hide();if(!n.collections&&!n.images)return o.loading.show("图片加载失败，请稍后再试试.."),void e(o.loading.hide,400);o.loading.show('<i class="icon ion-loading-c"></i> 图片加载中...');var u="home"===a?n.collections[i].images[0].uri:n.images[i].uri;c(u,s,d)}}function c(o,e,i){var t=new Image;t.onload=e,t.onerror=i,t.src=o+".jpg"}var l=this;this.load=n,this.loadCache=i,this.cache={}}var t;if(!o)throw new Error("Angular.js is required");e&&(t=e("tuchong-daily:ImageLoader")),o.module("tuchong-daily").service("imageLoader",["UI","$timeout",i])}(window.angular,window.debug),function(o,e,i){"use strict";function t(e,t,c,l,a,r,s,d,u,g){function h(o,e){return e.collectionId?void t.go("collection",{id:e.collectionId}):void u.alert(e.alert,"收到通知","知道了")}function f(o){function e(e){return e.collections?(n&&n("Reading fresh collections (%s)",e.collections.length),m(e.collections,!0),c.save("collections",e.collections),void(o&&o())):l.loading.show('<i class="icon ion-close-circled"></i> 网络连接失败...请稍后再试')}function i(){l.loading.show('<i class="icon ion-close-circled"></i> 网络连接失败...请稍后再试'),o&&o()}c.hot.get({},e,i)}function m(t,n){var c=i.lastSlideIndexHome,l=!c||parseInt(c)<=3;e.collections=n?o.copy(t).splice(0,3):o.copy(t).splice(0,l?3:parseInt(c)+1),d.load(0,e,"home"),a.update()}function p(o){isNaN(o)&&(o=0),n&&n("Switching to slide: [%s]",o),d.load(o,e,"home"),!e.collections[o+1]&&c.cache.collections[o+1]&&e.collections.push(c.cache.collections[o+1]),i.lastSlideIndexHome=o,n&&n("Set lastSlideIndexHome to %s",o),a.update()}function v(o,e){var i=e>1;return i?t.go("collection",{id:o}):(l.loading.show('<i class="icon ion-information-circled"></i> 这个相册只有一张图'),void r(l.loading.hide,400))}return e.go=v,e.share=g.popup,e.updateSlides=p,e.backgrounds=d.loadCache("home"),e.$on("pushNotificationReceived",h),l.loading.show('<i class="icon ion-refreshing"></i> 努力加载中...'),c.cache.collections?m(c.cache.collections):void f()}var n;if(!o)throw new Error("Angular.js is required");e&&(n=e("tuchong-daily:Controller:Home")),o.module("tuchong-daily").controller("home",["$scope","$state","Store","UI","$ionicSlideBoxDelegate","$timeout","$rootScope","imageLoader","$cordovaDialogs","share",t])}(window.angular,window.debug,window.localStorage),function(o,e,i){"use strict";function t(e,t,n,l,a,r,s,d,u,g,h){function f(o,e){return e.collectionId?void r.go("collection",{id:e.collectionId}):void h.alert(e.alert,"收到通知","知道了")}function m(t,n){var c=i.lastSlideIndexCollection,r=!c||parseInt(c)<=3;e.post=t.post,e.images=n?o.copy(t.images).splice(0,3):o.copy(t.images).splice(0,r?3:parseInt(c)+1),s.load(0,e,"collection",a.id),l.update()}function p(o){c&&c("Switching to slide: [%s]",o),s.load(o,e,"collection",a.id),i.lastSlideIndexCollection=o,c&&c("Set lastSlideIndexCollection to %s",o),!e.images[o+1]&&I.images[o+1]&&e.images.push(I.images[o+1]),l.update()}function v(o){var e="right"===o?"toggleRight":"toggleLeft";d[e]()}function w(){var o=i.lastSlideIndexCollection?parseInt(i.lastSlideIndexCollection):0;return e.images&&e.images[o]?void r.go("collection-single",{uri:e.images[o].uri}):(n.loading.show('<i class="icon ion-information-circled"></i> 啊喔，找不到大图了'),void g(n.loading.hide,500))}e.toggle=v,e.share=u.popup,e.viewLarge=w,e.updateSlides=p,e.backgrounds=s.loadCache(a.id),e.$on("pushNotificationReceived",f);var I=t.findById(a.id);return I?void m(I):void t.post.get({postId:a.id},function(o){c&&c(o),I=o,m(o,!0)},function(o){c&&c(o),r.go("home")})}function n(o,e,i,t){function n(o,e){return e.collectionId?void i.go("collection",{id:e.collectionId}):void t.alert(e.alert,"收到通知","知道了")}return e.uri?(o.uri=e.uri,void o.$on("pushNotificationReceived",n)):i.go("home")}var c;if(!o)throw new Error("Angular.js is required");e&&(c=e("tuchong-daily:Controller:Collection")),o.module("tuchong-daily").controller("collection",["$scope","Store","UI","$ionicSlideBoxDelegate","$stateParams","$state","imageLoader","$ionicSideMenuDelegate","share","$timeout","$cordovaDialogs",t]).controller("collection-single",["$scope","$stateParams","$state","$cordovaDialogs",n])}(window.angular,window.debug,window.localStorage);
//# sourceMappingURL=tuchong.min.js.map