!function(o){"use strict";function e(o,e,n,i,c,a,r){function l(o,e){function n(o){r.alert(o,"获取推送权限失败...","知道了")}var c={badge:"true",sound:"true",alert:"true"};i.register(c).then(function(n){var i={};return i.deviceType=o.platform?o.platform.toLowerCase():"ios","ios"===i.deviceType&&(i.deviceToken=n),"android"===i.deviceType&&(i.installationId=n),t.forEach(["model","uuid","version"],function(e){o[e]&&(i[e]=o[e])}),e(i)},n)}o.ready(function(){var o=e.getDevice(),t=n.getNetwork();console.log(o),console.log(t),"wifi"!==t&&"Connection.WIFI"!==t&&r.alert("检查到当前使用的网络不是 Wi-Fi，除非您使用 3G/4G 网络，图虫日报不建议在非 Wi-Fi 网络下加载大图","ヾ(´ρ｀)〃 流量提示","继续浏览"),l(o,function(o){function e(o){console.log(o)}function n(o){console.log(o)}console.log(o),a.installations.post(o,e,n)})})}function n(o,e,n,t,i,c){t.config(appConfigs.avoscloud),o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"],o.defaults.headers.common[c||"tuchong-daily-token"]=i,e.state("home",{url:"/",templateUrl:"templates/home.html",controller:"home"}),n.otherwise("/")}var t=o.angular;t.module("tuchong-daily",["ionic","avoscloud","ngResource","ngCordova"]).constant("API_TOKEN",appConfigs.API_TOKEN).constant("API_SERVER",appConfigs.API_SERVER).constant("API_TOKEN_KEY","tuchong-daily-token").constant("TC_SERVER","http://tuchong.com/api/").constant("$ionicLoadingConfig",{template:'<ion-spinner icon="lines"></ion-spinner>'}).config(["$httpProvider","$stateProvider","$urlRouterProvider","avoscloudProvider","API_TOKEN","API_TOKEN_KEY",n]).run(["$ionicPlatform","$cordovaDevice","$cordovaNetwork","$cordovaPush","$timeout","avoscloud","$cordovaDialogs","$state",e])}(this),function(o){"use strict";function e(o,e,t,i){var c=this;c.tuchong={};var a={hot:"/daily",post:"/post"},r={post:"post/get-post-and-images"},l={post:{method:"POST"},update:{method:"PUT"},put:{method:"PUT"}};c.cache={},n.forEach(a,function(n,t){c[t]=o(e+n,null,l)}),n.forEach(r,function(e,n){c.tuchong[n]=o(i+e,null,l)}),c.save=function(o,e){c.cache[o]=e},c.findById=function(o){var e=null;return o&&c.cache.collections?(n.forEach(c.cache.collections,function(n){n.postId===o&&(e=n)}),e):e}}var n=o.angular;n.module("tuchong-daily").service("Store",["$resource","API_SERVER","API_TOKEN","TC_SERVER",e])}(this),function(o){"use strict";function e(e,n){function t(e,t){function i(n){if(o.Wechat){var i=t.title,c=e||null,a=t.site&&t.site.description?t.site.description:"";c&&c.excerpt&&(i+=" - "+c.excerpt),t&&t.author&&t.author.name&&(i+=" @"+t.author.name),a+=" 图虫日报，精选每日图虫热门图片。",Wechat.share({message:{title:i,description:a,thumb:c?c.uri_grid+".jpg":"http://ww2.sinaimg.cn/large/61ff0de3gw1emj19ju7p4j2030030745.jpg",media:{type:Wechat.Type.WEBPAGE,webpageUrl:t.url}},scene:n})}}var c={};c.titleText="与朋友们分享好图",c.cancelText="算了",c.buttonClicked=i,c.buttons=[{text:'<i class="icon ion-at"></i> 分享给微信小伙伴'},{text:'<i class="icon ion-chatbubbles"></i> 分享到微信朋友圈'},{text:'<i class="icon ion-star"></i> 添加到微信收藏夹'}],n.show(c)}this.popup=t}var n=o.angular;n.module("tuchong-daily").service("share",["$ionicLoading","$ionicActionSheet",e])}(this),function(o){"use strict";function e(o,e){function n(n,i){function c(){o.hide(),i(l.blobURL),l=null}function a(){o.show({template:"图片加载失败，请稍后再试试..."}),l=null,e(o.hide,1e3)}function r(o){return o.replace("http://photos.tuchong.com","http://localhost:8100/photos")}o.show();var l=new BlobImage(t?n:r(n));l.element.onload=c,l.element.onerror=a}this.load=n}var n=o.angular,t=(o.ImageLoader,o.navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i));n.module("tuchong-daily").service("imageLoader",["$ionicLoading","$timeout",e])}(this),function(o){"use strict";function e(o,e,n,t,i,c,a,r,l){function s(o){function t(n){return o?u([n]):n.collections?(u(n.collections),void e.save("collections",n)):i()}function i(){return n.show({template:'<i class="icon ion-ios-close-outline"></i> 网络连接失败...请稍后再试'}),!1}var c={};o&&(c.postId=o),e[o?"post":"hot"].get(c,t,i)}function u(e){o.collections=o.collections?e.concat(o.collections):e,o.slidesReady||(o.slidesReady=!0),n.hide(),1===o.collections[0].images.length?h(0):(f(0,0),t(function(){d(0)},10)),t(function(){$=new Swiper(".swiper-container-collection",{onSlideChangeStart:function(){var e=$.activeIndex;h(e),o.collections[e].images.length>1&&"undefined"==typeof y[e]&&!function(o){d(o),f(o,0)}(e)}})},10)}function d(o){y[o]=new Swiper("#children-"+o,{direction:"vertical",onSlideChangeStart:function(){f(o,y[o].activeIndex)}})}function h(e){E[e]||i.load(o.collections[e].images[0].uri+".jpg",function(n){o.backgrounds[e]=n,o.$apply()})}function f(e,n){Array.isArray(o.childrens[e])&&o.childrens[e][n]||(Array.isArray(o.childrens[e])||(o.childrens[e]=[]),i.load(o.collections[e].images[n].uri+".jpg",function(t){o.childrens[e][n]=t,o.$apply()}))}function p(e){o.zoomImage=e,n.show({scope:o,templateUrl:"zoom-modal",hideOnStateChange:!0})}function g(){n.hide()}function m(o){return o?"url("+o+")":"none"}function v(o,e){return e.collectionId?s(e.collectionId):void l.alert(e.alert,"收到通知","知道了")}r.$on("pushNotificationReceived",v),o.share=c.popup,o.makeCssUri=m,o.openZoom=p,o.hideZoom=g;{var $=null,y={},E=o.backgrounds=[];o.childrens={}}return n.show(),e.cache.collections?u(e.cache.collections):void s()}var n=o.angular;n.module("tuchong-daily").controller("home",["$scope","Store","$ionicLoading","$timeout","imageLoader","share","$ionicModal","$rootScope","$cordovaDialogs",e])}(this);
//# sourceMappingURL=tuchong.min.js.map