!function(o){"use strict";function e(o,e,t,i,c,a,l){function r(o,e){function t(o){l.alert(o,"获取推送权限失败...","知道了")}var c={badge:"true",sound:"true",alert:"true"};i.register(c).then(function(t){var i={};return i.deviceType=o.platform?o.platform.toLowerCase():"ios","ios"===i.deviceType&&(i.deviceToken=t),"android"===i.deviceType&&(i.installationId=t),n.forEach(["model","uuid","version"],function(e){o[e]&&(i[e]=o[e])}),e(i)},t)}o.ready(function(){var o=e.getDevice(),n=t.getNetwork();console.log(o),console.log(n),"wifi"!==n&&"Connection.WIFI"!==n&&l.alert("检查到当前使用的网络不是 Wi-Fi，除非您使用 3G/4G 网络，图虫日报不建议在非 Wi-Fi 网络下加载大图","ヾ(´ρ｀)〃 流量提示","继续浏览"),r(o,function(o){function e(o){console.log(o)}function t(o){console.log(o)}console.log(o),a.installations.post(o,e,t)})})}function t(o,e,t,n,i,c){n.config(appConfigs.avoscloud),o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"],o.defaults.headers.common[c||"tuchong-daily-token"]=i,e.state("home",{url:"/",templateUrl:"templates/home.html",controller:"home"}),t.otherwise("/")}var n=o.angular;n.module("tuchong-daily",["ionic","avoscloud","ngResource","ngCordova"]).constant("API_TOKEN",appConfigs.API_TOKEN).constant("API_SERVER",appConfigs.API_SERVER).constant("API_TOKEN_KEY","tuchong-daily-token").constant("TC_SERVER","http://tuchong.com/api/").constant("$ionicLoadingConfig",{template:'<ion-spinner icon="lines"></ion-spinner>'}).config(["$httpProvider","$stateProvider","$urlRouterProvider","avoscloudProvider","API_TOKEN","API_TOKEN_KEY",t]).run(["$ionicPlatform","$cordovaDevice","$cordovaNetwork","$cordovaPush","$timeout","avoscloud","$cordovaDialogs","$state",e])}(this),function(o){"use strict";function e(o,e,n,i){var c=this;c.tuchong={};var a={hot:"/daily",post:"/post"},l={post:"post/get-post-and-images"},r={post:{method:"POST"},update:{method:"PUT"},put:{method:"PUT"}};c.cache={},t.forEach(a,function(t,n){c[n]=o(e+t,null,r)}),t.forEach(l,function(e,t){c.tuchong[t]=o(i+e,null,r)}),c.save=function(o,e){c.cache[o]=e},c.findById=function(o){var e=null;return o&&c.cache.collections?(t.forEach(c.cache.collections,function(t){t.postId===o&&(e=t)}),e):e}}var t=o.angular;t.module("tuchong-daily").service("Store",["$resource","API_SERVER","API_TOKEN","TC_SERVER",e])}(this),function(o){"use strict";function e(e,t){function n(e,n){function i(t){if(o.Wechat){var i=n.title,c=e||null,a=n.site&&n.site.description?n.site.description:"";c&&c.excerpt&&(i+=" - "+c.excerpt),n&&n.author&&n.author.name&&(i+=" @"+n.author.name),a+=" 图虫日报，精选每日图虫热门图片。",Wechat.share({message:{title:i,description:a,thumb:c?c.uri_grid+".jpg":"http://ww2.sinaimg.cn/large/61ff0de3gw1emj19ju7p4j2030030745.jpg",media:{type:Wechat.Type.WEBPAGE,webpageUrl:n.url}},scene:t})}}var c={};c.titleText="与朋友们分享好图",c.cancelText="算了",c.buttonClicked=i,c.buttons=[{text:'<i class="icon ion-at"></i> 分享给微信小伙伴'},{text:'<i class="icon ion-chatbubbles"></i> 分享到微信朋友圈'},{text:'<i class="icon ion-star"></i> 添加到微信收藏夹'}],t.show(c)}this.popup=n}var t=o.angular;t.module("tuchong-daily").service("share",["$ionicLoading","$ionicActionSheet",e])}(this),function(o){"use strict";function e(o,e){function t(t,i,c){function a(){o.hide(),i(s.blobURL),s=null}function l(){o.show({template:"图片加载失败，请稍后再试试..."}),s=null,e(o.hide,1e3)}function r(o){return o.replace("http://photos.tuchong.com","http://localhost:8100/photos")}c&&o.show();var s=new BlobImage(n?t:r(t));s.element.onload=a,s.element.onerror=l}this.load=t}var t=o.angular,n=(o.ImageLoader,o.navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i));t.module("tuchong-daily").service("imageLoader",["$ionicLoading","$timeout",e])}(this),function(o){"use strict";function e(o,e,n,i,c,a,l,r,s){function u(o){function t(t){return o?(t.postId=o,d([t])):t.collections?(d(t.collections),void e.save("collections",t)):i()}function i(){return n.show({template:'<i class="icon ion-ios-close-outline"></i> 网络连接失败...请稍后再试'}),!1}var c={};o&&(c.postId=o),e[o?"post":"hot"].get(c,t,i)}function d(e){var t=o.collections&&o.collections.length>0;o.collections=t?o.collections.concat(e):e,o.slidesReady||(o.slidesReady=!0),n.hide();var c=t&&1===e.length?p(e[0].postId,o.collections):0;h(c,{showLoading:!0,setupChildrenSwiper:!0,loadFirstChild:!0}),0===c&&h(1),i(function(){return t&&E?(E.updateSlidesSize(),void(0!==c&&E.slideTo(c))):void(E=new Swiper(".swiper-container-collection",{onSlideChangeStart:function(){h(E.activeIndex,{showLoading:!0,setupChildrenSwiper:!0,loadFirstChild:!0})}}))},10)}function h(e,t){return o.collections[e]||(e-=1),1===o.collections[e].images.length?g(e,t):(m(e,0,t),t&&t.loadFirstChild&&m(e,1,t),void(t&&t.setupChildrenSwiper&&"undefined"==typeof I[e]&&i(function(){f(e)},10)))}function p(o,e){var n;return t.forEach(e,function(e,t){e.postId===o&&(n=t)}),n}function f(o){I[o]=new Swiper("#children-"+o,{direction:"vertical",onSlideChangeStart:function(){m(o,I[o].activeIndex)}})}function g(e,t){return S[e]?o.$apply():void c.load(o.collections[e].images[0].uri+".jpg",function(t){S[e]=t,o.$apply()},t&&t.showLoading||!0)}function m(e,t,n){return Array.isArray(P[e])&&P[e][t]?o.$apply():(Array.isArray(P[e])||(P[e]=[]),void(o.collections[e]&&o.collections[e].images[t]&&c.load(o.collections[e].images[t].uri+".jpg",function(n){P[e][t]=n,o.$apply()},n&&n.showLoading||!0)))}function v(e){o.zoomImage=e,n.show({scope:o,templateUrl:"zoom-modal",hideOnStateChange:!0})}function w(){n.hide()}function $(o){return o?"url("+o+")":"none"}function y(o,e){return e.collectionId?u(e.collectionId):void s.alert(e.alert,"收到通知","知道了")}r.$on("pushNotificationReceived",y),o.share=a.popup,o.makeCssUri=$,o.openZoom=v,o.hideZoom=w;var E=null,I={},S=o.backgrounds=[],P=o.childrens={};return n.show(),e.cache.collections?d(e.cache.collections):void u()}var t=o.angular;t.module("tuchong-daily").controller("home",["$scope","Store","$ionicLoading","$timeout","imageLoader","share","$ionicModal","$rootScope","$cordovaDialogs",e])}(this);
//# sourceMappingURL=tuchong.min.js.map