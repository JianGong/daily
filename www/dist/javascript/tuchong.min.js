!function(o){"use strict";function e(o,e,t,i,c,l,a,s,r){function u(o,e){function t(o){a.alert(o,"获取推送权限失败...","知道了")}var c={badge:"true",sound:"true",alert:"true"};i.register(c).then(function(t){var i={};return i.deviceType=o.platform?o.platform.toLowerCase():"ios","ios"===i.deviceType&&(i.deviceToken=t),"android"===i.deviceType&&(i.installationId=t),n.forEach(["model","uuid","version"],function(e){o[e]&&(i[e]=o[e])}),e(i)},t)}function d(o,e){return e.collectionId?void r.go("collection",{id:e.collectionId}):void a.alert(e.alert,"收到通知","知道了")}function g(o,e,t,n){console.log("%s => %s",n.name||"init",e.name);var i="home"===e.name&&n.name,c="home"===n.name&&"collection"===e.name,l="collection-single"===n.name&&"collection"===e.name;if((i||c||l)&&!c){var a=i?localStorage.lastSlideIndexHome:localStorage.lastSlideIndexCollection;a||(a=0),a=parseInt(a)}}localStorage.lastSlideIndexHome&&localStorage.removeItem("lastSlideIndexHome"),s.$on("$stateChangeSuccess",g),s.$on("pushNotificationReceived",d),o.ready(function(){var o=e.getDevice(),n=t.getNetwork();console.log(o),console.log(n),"wifi"!==n&&"Connection.WIFI"!==n&&a.alert("检查到当前使用的网络不是 Wi-Fi，除非您使用 3G/4G 网络，图虫日报不建议在非 Wi-Fi 网络下加载大图","ヾ(´ρ｀)〃 流量提示","继续浏览"),u(o,function(o){function e(o){console.log(o)}function t(o){console.log(o)}console.log(o),l.installations.post(o,e,t)})})}function t(o,e,t,n,i,c){n.config(appConfigs.avoscloud),o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"],o.defaults.headers.common[c||"tuchong-daily-token"]=i,e.state("home",{url:"/",templateUrl:"templates/home.html",controller:"home"}).state("collection",{url:"/collection/:id",templateUrl:"templates/collection.html",controller:"collection"}),t.otherwise("/")}var n=o.angular;n.module("tuchong-daily",["ionic","avoscloud","ngResource","ngCordova"]).constant("API_TOKEN",appConfigs.API_TOKEN).constant("API_SERVER",appConfigs.API_SERVER).constant("API_TOKEN_KEY","tuchong-daily-token").constant("TC_SERVER","http://tuchong.com/api/").constant("$ionicLoadingConfig",{template:'<ion-spinner icon="lines"></ion-spinner>'}).config(["$httpProvider","$stateProvider","$urlRouterProvider","avoscloudProvider","API_TOKEN","API_TOKEN_KEY",t]).run(["$ionicPlatform","$cordovaDevice","$cordovaNetwork","$cordovaPush","$timeout","avoscloud","$cordovaDialogs","$rootScope","$state",e])}(this),function(o){"use strict";function e(o,e,n,i){var c=this;c.tuchong={};var l={hot:"/daily",post:"/post"},a={post:"post/get-post-and-images"},s={post:{method:"POST"},update:{method:"PUT"},put:{method:"PUT"}};c.cache={},t.forEach(l,function(t,n){c[n]=o(e+t,null,s)}),t.forEach(a,function(e,t){c.tuchong[t]=o(i+e,null,s)}),c.save=function(o,e){c.cache[o]=e},c.findById=function(o){var e=null;return o&&c.cache.collections?(t.forEach(c.cache.collections,function(t){t.postId===o&&(e=t)}),e):e}}var t=o.angular;t.module("tuchong-daily").service("Store",["$resource","API_SERVER","API_TOKEN","TC_SERVER",e])}(this),function(o){"use strict";function e(e,t){function n(e,n){function i(t){if(o.Wechat){var i=n.title,c=e||null,l=n.site&&n.site.description?n.site.description:"";c&&c.excerpt&&(i+=" - "+c.excerpt),n&&n.author&&n.author.name&&(i+=" @"+n.author.name),l+=" 图虫日报，精选每日图虫热门图片。",Wechat.share({message:{title:i,description:l,thumb:c?c.uri_grid+".jpg":"http://ww2.sinaimg.cn/large/61ff0de3gw1emj19ju7p4j2030030745.jpg",media:{type:Wechat.Type.WEBPAGE,webpageUrl:n.url}},scene:t})}}var c={};c.titleText="与朋友们分享好图",c.cancelText="算了",c.buttonClicked=i,c.buttons=[{text:'<i class="icon ion-at"></i> 分享给微信小伙伴'},{text:'<i class="icon ion-chatbubbles"></i> 分享到微信朋友圈'},{text:'<i class="icon ion-star"></i> 添加到微信收藏夹'}],t.show(c)}this.popup=n}var t=o.angular;t.module("tuchong-daily").service("share",["$ionicLoading","$ionicActionSheet",e])}(this),function(o){"use strict";function e(o,e){function t(t,i){function c(){o.hide(),i(s.blobURL),s=null}function l(){o.show({template:"图片加载失败，请稍后再试试..."}),s=null,e(o.hide,1e3)}function a(o){return o.replace("http://photos.tuchong.com","http://localhost:8100/photos")}o.show();var s=new BlobImage(n?t:a(t));s.element.onload=c,s.element.onerror=l}this.load=t}var t=o.angular,n=(o.ImageLoader,o.navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i));t.module("tuchong-daily").service("imageLoader",["$ionicLoading","$timeout",e])}(this),function(o){"use strict";function e(o,e,t,n,i,c){function l(){function o(o){return o.collections?(a(o.collections),void e.save("collections",o)):n()}function n(){return t.show({template:'<i class="icon ion-ios-close-outline"></i> 网络连接失败...请稍后再试'}),!1}e.hot.get({},o,n)}function a(e){o.collections=e,o.slidesReady||(o.slidesReady=!0),t.hide(),1===o.collections[0].images.length?r(0):(u(0,0),n(function(){s(0)},10)),n(function(){m=new Swiper(".swiper-container-collection",{onSlideChangeStart:function(){var e=m.activeIndex;r(e),o.collections[e].images.length>1&&"undefined"==typeof p[e]&&!function(o){s(o),u(o,0)}(e)}})},10)}function s(o){p[o]=new Swiper("#children-"+o,{direction:"vertical",onSlideChangeStart:function(){u(o,p[o].activeIndex)}})}function r(e){f[e]||i.load(o.collections[e].images[0].uri+".jpg",function(t){o.backgrounds[e]=t,o.$apply()})}function u(e,t){Array.isArray(o.childrens[e])&&o.childrens[e][t]||(Array.isArray(o.childrens[e])||(o.childrens[e]=[]),i.load(o.collections[e].images[t].uri+".jpg",function(n){o.childrens[e][t]=n,o.$apply()}))}function d(e){o.zoomImage=e,t.show({scope:o,templateUrl:"zoom-modal",hideOnStateChange:!0})}function g(){t.hide()}function h(o){return o?"url("+o+")":"none"}o.share=c.popup,o.makeCssUri=h,o.openZoom=d,o.hideZoom=g;{var m=null,p={},f=o.backgrounds=[];o.childrens={}}return t.show(),e.cache.collections?a(e.cache.collections):void l()}var t=o.angular;t.module("tuchong-daily").controller("home",["$scope","Store","$ionicLoading","$timeout","imageLoader","share","$ionicModal",e])}(this),function(o){"use strict";function e(o,e,t,c,l,a,s,r,u,d){function g(e,t){var a=i.lastSlideIndexCollection,r=!a||parseInt(a)<=3;o.post=e.post,o.images=t?n.copy(e.images).splice(0,3):n.copy(e.images).splice(0,r?3:parseInt(a)+1),s.load(0,o,"collection",l.id),c.update()}function h(e){console.log("Switching to slide: [%s]",e),s.load(e,o,"collection",l.id),i.lastSlideIndexCollection=e,console.log("Set lastSlideIndexCollection to %s",e),!o.images[e+1]&&f.images[e+1]&&o.images.push(f.images[e+1]),c.update()}function m(o){var e="right"===o?"toggleRight":"toggleLeft";r[e]()}function p(){var e=i.lastSlideIndexCollection?parseInt(i.lastSlideIndexCollection):0;return o.images&&o.images[e]?void a.go("collection-single",{uri:o.images[e].uri}):(t.show({template:'<i class="icon ion-information-circled"></i> 啊喔，找不到大图了'}),void d(t.hide,500))}o.toggle=m,o.share=u.popup,o.viewLarge=p,o.updateSlides=h,o.backgrounds=s.loadCache(l.id);var f=e.findById(l.id);return f?void g(f):void e.post.get({postId:l.id},function(o){f=o,g(o,!0)},function(){a.go("home")})}function t(o,e,t,n){function i(o,e){return e.collectionId?void t.go("collection",{id:e.collectionId}):void n.alert(e.alert,"收到通知","知道了")}return e.uri?(o.uri=e.uri,void o.$on("pushNotificationReceived",i)):t.go("home")}var n=o.angular,i=o.localStorage;n.module("tuchong-daily").controller("collection",["$scope","Store","$ionicLoading","$ionicSlideBoxDelegate","$stateParams","$state","imageLoader","$ionicSideMenuDelegate","share","$timeout","$cordovaDialogs",e]).controller("collection-single",["$scope","$stateParams","$state","$cordovaDialogs",t])}(this);
//# sourceMappingURL=tuchong.min.js.map