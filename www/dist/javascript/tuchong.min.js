!function(o){"use strict";function e(o,e,t,n,c,l,a,s,r,u){function d(o,e){function t(o){a.alert(o,"获取推送权限失败...","知道了")}var c={badge:"true",sound:"true",alert:"true"};n.register(c).then(function(t){var n={};return n.deviceType=o.platform?o.platform.toLowerCase():"ios","ios"===n.deviceType&&(n.deviceToken=t),"android"===n.deviceType&&(n.installationId=t),i.forEach(["model","uuid","version"],function(e){o[e]&&(n[e]=o[e])}),e(n)},t)}function g(o,e){return e.collectionId?void u.go("collection",{id:e.collectionId}):void a.alert(e.alert,"收到通知","知道了")}function h(o,e,t,i){console.log("%s => %s",i.name||"init",e.name);var n="home"===e.name&&i.name,l="home"===i.name&&"collection"===e.name,a="collection-single"===i.name&&"collection"===e.name;if((n||l||a)&&!l){var r=n?localStorage.lastSlideIndexHome:localStorage.lastSlideIndexCollection;r||(r=0),r=parseInt(r),c(function(){s.slide(r)},300)}}localStorage.lastSlideIndexHome&&localStorage.removeItem("lastSlideIndexHome"),r.$on("$stateChangeSuccess",h),r.$on("pushNotificationReceived",g),o.ready(function(){var o=e.getDevice(),i=t.getNetwork();console.log(o),console.log(i),"wifi"!==i&&"Connection.WIFI"!==i&&a.alert("检查到当前使用的网络不是 Wi-Fi，除非您使用 3G/4G 网络，图虫日报不建议在非 Wi-Fi 网络下加载大图","ヾ(´ρ｀)〃 流量提示","继续浏览"),d(o,function(o){function e(o){console.log(o)}function t(o){console.log(o)}console.log(o),l.installations.post(o,e,t)})})}function t(o,e,t,i,n,c){i.config(appConfigs.avoscloud),o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"],o.defaults.headers.common[c||"tuchong-daily-token"]=n,e.state("home",{url:"/",templateUrl:"templates/home.html",controller:"home"}).state("collection",{url:"/collection/:id",templateUrl:"templates/collection.html",controller:"collection"}).state("collection-single",{url:"/images?uri",templateUrl:"templates/single.html",controller:"collection-single"}),t.otherwise("/")}var i=o.angular;i.module("tuchong-daily",["ionic","avoscloud","ngResource","ngCordova"]).constant("API_TOKEN",appConfigs.API_TOKEN).constant("API_SERVER",appConfigs.API_SERVER).constant("API_TOKEN_KEY","tuchong-daily-token").constant("TC_SERVER","http://tuchong.com/api/").config(["$httpProvider","$stateProvider","$urlRouterProvider","avoscloudProvider","API_TOKEN","API_TOKEN_KEY",t]).run(["$ionicPlatform","$cordovaDevice","$cordovaNetwork","$cordovaPush","$timeout","avoscloud","$cordovaDialogs","$ionicSlideBoxDelegate","$rootScope","$state",e])}(this),function(o){"use strict";function e(o,e,i,n){var c=this;c.tuchong={};var l={hot:"/daily",post:"/post"},a={post:"post/get-post-and-images"},s={post:{method:"POST"},update:{method:"PUT"},put:{method:"PUT"}};c.cache={},t.forEach(l,function(t,i){c[i]=o(e+t,null,s)}),t.forEach(a,function(e,t){c.tuchong[t]=o(n+e,null,s)}),c.save=function(o,e){c.cache[o]=e},c.findById=function(o){var e=null;return o&&c.cache.collections?(t.forEach(c.cache.collections,function(t){t.postId===o&&(e=t)}),e):e}}var t=o.angular;t.module("tuchong-daily").service("Store",["$resource","API_SERVER","API_TOKEN","TC_SERVER",e])}(this),function(o){"use strict";function e(e,t){function i(e,i){function n(t){if(o.Wechat){var n=i.title,c=e||null,l=i.site&&i.site.description?i.site.description:"";c&&c.excerpt&&(n+=" - "+c.excerpt),i&&i.author&&i.author.name&&(n+=" @"+i.author.name),l+=" 图虫日报，精选每日图虫热门图片。",Wechat.share({message:{title:n,description:l,thumb:c?c.uri_grid+".jpg":"http://ww2.sinaimg.cn/large/61ff0de3gw1emj19ju7p4j2030030745.jpg",media:{type:Wechat.Type.WEBPAGE,webpageUrl:i.url}},scene:t})}}var c={};c.titleText="与朋友们分享好图",c.cancelText="算了",c.buttonClicked=n,c.buttons=[{text:'<i class="icon ion-at"></i> 分享给微信小伙伴'},{text:'<i class="icon ion-chatbubbles"></i> 分享到微信朋友圈'},{text:'<i class="icon ion-star"></i> 添加到微信收藏夹'}],t.show(c)}this.popup=i}var t=o.angular;t.module("tuchong-daily").service("share",["$ionicLoading","$ionicActionSheet",e])}(this),function(o){"use strict";function e(o){function e(e,t){function n(){o.hide(),t(a.blobURL),a=null}function c(){o.show({template:"图片加载失败，请稍后再试试..."}),a=null}function l(o){return o.replace("http://photos.tuchong.com","http://localhost:8100/photos")}o.show({template:'<i class="icon ion-loading-c"></i> 图片加载中...'});var a=new BlobImage(i?e:l(e));a.element.onload=n,a.element.onerror=c}this.load=e}var t=o.angular,i=(o.ImageLoader,o.navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i));t.module("tuchong-daily").service("imageLoader",["$ionicLoading","$timeout",e])}(this),function(o){"use strict";function e(o,e,t,i,n,c,l){function a(){function o(o){return o.collections?(s(o.collections,!0),void t.save("collections",o.collections)):void i.show({template:'<i class="icon ion-close-circled"></i> 网络连接失败...请稍后再试'})}function e(){i.show({template:'<i class="icon ion-close-circled"></i> 网络连接失败...请稍后再试'})}t.hot.get({},o,e)}function s(e){o.collections=e,o.slidesReady||(o.slidesReady=!0),i.hide(),r(0),n(function(){m=new Swiper(".swiper-container-collection"),new Swiper(".swiper-container-children",{direction:"vertical"}),r(1)},10)}function r(e){p[e]||c.load(o.collections[e].images[0].uri+".jpg",function(t){o.backgrounds[e]=t,o.$apply()})}function u(e){o.zoomImage=e,i.show({scope:o,templateUrl:"zoom-modal",hideOnStateChange:!0})}function d(){i.hide()}function g(o,e,t){return e?0===t?p[o]:e:p[o]||""}function h(o){return"url("+o+")"}o.share=l.popup,o.fetchBackground=g,o.makeCssUri=h,o.openZoom=u,o.hideZoom=d;var m,p=o.backgrounds=[];return i.show({template:'<i class="icon ion-refreshing"></i> 努力加载中...'}),t.cache.collections?s(t.cache.collections):void a()}{var t=o.angular;o.localStorage}t.module("tuchong-daily").controller("home",["$scope","$state","Store","$ionicLoading","$timeout","imageLoader","share","$ionicModal",e])}(this),function(o){"use strict";function e(o,e,t,c,l,a,s,r,u,d){function g(e,t){var a=n.lastSlideIndexCollection,r=!a||parseInt(a)<=3;o.post=e.post,o.images=t?i.copy(e.images).splice(0,3):i.copy(e.images).splice(0,r?3:parseInt(a)+1),s.load(0,o,"collection",l.id),c.update()}function h(e){console.log("Switching to slide: [%s]",e),s.load(e,o,"collection",l.id),n.lastSlideIndexCollection=e,console.log("Set lastSlideIndexCollection to %s",e),!o.images[e+1]&&f.images[e+1]&&o.images.push(f.images[e+1]),c.update()}function m(o){var e="right"===o?"toggleRight":"toggleLeft";r[e]()}function p(){var e=n.lastSlideIndexCollection?parseInt(n.lastSlideIndexCollection):0;return o.images&&o.images[e]?void a.go("collection-single",{uri:o.images[e].uri}):(t.show({template:'<i class="icon ion-information-circled"></i> 啊喔，找不到大图了'}),void d(t.hide,500))}o.toggle=m,o.share=u.popup,o.viewLarge=p,o.updateSlides=h,o.backgrounds=s.loadCache(l.id);var f=e.findById(l.id);return f?void g(f):void e.post.get({postId:l.id},function(o){f=o,g(o,!0)},function(){a.go("home")})}function t(o,e,t,i){function n(o,e){return e.collectionId?void t.go("collection",{id:e.collectionId}):void i.alert(e.alert,"收到通知","知道了")}return e.uri?(o.uri=e.uri,void o.$on("pushNotificationReceived",n)):t.go("home")}var i=o.angular,n=o.localStorage;i.module("tuchong-daily").controller("collection",["$scope","Store","$ionicLoading","$ionicSlideBoxDelegate","$stateParams","$state","imageLoader","$ionicSideMenuDelegate","share","$timeout","$cordovaDialogs",e]).controller("collection-single",["$scope","$stateParams","$state","$cordovaDialogs",t])}(this);
//# sourceMappingURL=tuchong.min.js.map