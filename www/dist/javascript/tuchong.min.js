!function(o,e){"use strict";function i(e,i,n,l,c,a,r,s,u,d){function g(e,i){function n(o){t&&t(o),r.alert(o,"获取推送权限失败...","知道了")}var c={badge:"true",sound:"true",alert:"true"};l.register(c).then(function(n){t&&t("Push service signup success, token: %s",n);var l={};return l.deviceType=e.platform?e.platform.toLowerCase():"ios","ios"===l.deviceType&&(l.deviceToken=n),"android"===l.deviceType&&(l.installationId=n),o.forEach(["model","uuid","version"],function(o){e[o]&&(l[o]=e[o])}),i(l)},n)}function h(o,e){return e.collectionId?void d.go("collection",{id:e.collectionId}):void r.alert(e.alert,"收到通知","知道了")}function f(o,e,i,n){t&&t("%s => %s",n.name||"init",e.name);var l="home"===e.name&&n.name,a="home"===n.name&&"collection"===e.name,r="collection-single"===n.name&&"collection"===e.name;if((l||a||r)&&!a){var u=l?localStorage.lastSlideIndexHome:localStorage.lastSlideIndexCollection;u||(u=0),u=parseInt(u),t&&t("Going back to %s",u),c(function(){s.slide(u)},300)}}localStorage.lastSlideIndexHome&&localStorage.removeItem("lastSlideIndexHome"),u.$on("$stateChangeSuccess",f),u.$on("pushNotificationReceived",h),e.ready(function(){var o=i.getDevice(),e=n.getNetwork();t&&(t(o),t(e)),"wifi"!==e&&"Connection.WIFI"!==e&&r.alert("检查到当前使用的网络不是 Wi-Fi，除非您使用 3G/4G 网络，图虫日报不建议在非 Wi-Fi 网络下加载大图","ヾ(´ρ｀)〃 流量提示","继续浏览"),g(o,function(o){function e(o){t&&t(o)}function i(o){t&&t(o)}t&&t(o),a.installations.post(o,e,i)})})}function n(o,e,i,n,t,l){n.config(appConfigs.avoscloud),o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"],o.defaults.headers.common[l||"tuchong-daily-token"]=t,e.state("home",{url:"/",templateUrl:"templates/home.html",controller:"home"}).state("collection",{url:"/collection/:id",templateUrl:"templates/collection.html",controller:"collection"}).state("collection-single",{url:"/images?uri",templateUrl:"templates/single.html",controller:"collection-single"}),i.otherwise("/")}var t;if(!o)throw new Error("Angular.js is required");e&&(t=e("tuchong-daily:app")),o.module("tuchong-daily",["ionic","avoscloud","ngResource","ngCordova"]).constant("API_TOKEN",appConfigs.API_TOKEN).constant("API_SERVER",appConfigs.API_SERVER).constant("API_TOKEN_KEY","tuchong-daily-token").constant("TC_SERVER","http://tuchong.com/api/").config(["$httpProvider","$stateProvider","$urlRouterProvider","avoscloudProvider","API_TOKEN","API_TOKEN_KEY",n]).run(["$ionicPlatform","$cordovaDevice","$cordovaNetwork","$cordovaPush","$timeout","avoscloud","$cordovaDialogs","$ionicSlideBoxDelegate","$rootScope","$state",i])}(window.angular,window.debug),function(o,e){"use strict";function i(o,e){this.loading={show:function(e){var i={};return i.template=e,o.show(i)},hide:function(){return o.hide()}},this.alert=function(o,i){e.alert(o).then(i)},this.confirm=function(o,i){e.confirm(o).then(i)},this.popup=function(o,i){e.show(o).then(i)}}var n;if(!o)throw new Error("Angular.js is required");e&&(n=e("tuchong-daily:UI")),o.module("tuchong-daily").service("UI",["$ionicLoading","$ionicPopup",i])}(window.angular,window.debug),function(o,e){"use strict";function i(e,i,n,t){var l=this;l.tuchong={};var c={hot:"/daily",post:"/post"},a={post:"post/get-post-and-images"},r={post:{method:"POST"},update:{method:"PUT"},put:{method:"PUT"}};l.cache={},o.forEach(c,function(o,n){l[n]=e(i+o,null,r)}),o.forEach(a,function(o,i){l.tuchong[i]=e(t+o,null,r)}),l.save=function(o,e){l.cache[o]=e},l.findById=function(e){var i=null;return e&&l.cache.collections?(o.forEach(l.cache.collections,function(o){o.postId===e&&(i=o)}),i):i}}var n;if(!o)throw new Error("Angular.js is required");e&&(n=e("tuchong-daily:Store")),o.module("tuchong-daily").service("Store",["$resource","API_SERVER","API_TOKEN","TC_SERVER",i])}(window.angular,window.debug),function(o,e){"use strict";function i(o,e){function i(o,i){function t(e){if(window.Wechat){var t=i.title,l=o||null,c=i.site&&i.site.description?i.site.description:"";l&&l.excerpt&&(t+=" - "+l.excerpt),i&&i.author&&i.author.name&&(t+=" @"+i.author.name),c+=" 图虫日报，精选每日图虫热门图片。",Wechat.share({message:{title:t,description:c,thumb:l?l.uri_grid+".jpg":"http://ww2.sinaimg.cn/large/61ff0de3gw1emj19ju7p4j2030030745.jpg",media:{type:Wechat.Type.WEBPAGE,webpageUrl:i.url}},scene:e},function(){n&&n("Shared !")},function(o){n&&n(o)})}}var l={};l.buttons=[],l.buttons.push({text:'<i class="icon ion-at"></i> 分享给微信小伙伴'},{text:'<i class="icon ion-chatbubbles"></i> 分享到微信朋友圈'},{text:'<i class="icon ion-star"></i> 添加到微信收藏夹'}),l.titleText="与朋友们分享好图",l.cancelText="算了",l.buttonClicked=t,e.show(l)}this.popup=i}var n;if(!o)throw new Error("Angular.js is required");e&&(n=e("tuchong-daily:Share")),o.module("tuchong-daily").service("share",["$ionicLoading","$ionicActionSheet",i])}(window.angular,window.debug),function(o,e,i){"use strict";function n(o,e){function n(o){return a.cache[o]?a.cache[o]:[]}function l(i,n,l,r){function s(){t&&t("Image loaded: %s",d+".jpg"),n.backgrounds[i]=d,n.$apply(),n.slidesReady||(n.slidesReady=!0);var e="home"===l?l:r;a.cache[e]=n.backgrounds,o.loading.hide()}function u(){o.loading.show("图片加载失败，请稍后再试试...")}if(void 0!==i&&null!==i&&!isNaN(i)){if(n.backgrounds[i])return t&&t("Reading image from cache"),n.slidesReady||(n.slidesReady=!0),o.loading.hide();if(!n.collections&&!n.images)return o.loading.show("图片加载失败，请稍后再试试.."),void e(o.loading.hide,400);o.loading.show('<i class="icon ion-loading-c"></i> 图片加载中...');var d="home"===l?n.collections[i].images[0].uri:n.images[i].uri;c(d,s,u)}}function c(o,e,i){console.log(o+".jpg222"),u.createImage(o+".jpg",function(o,n){n.onload=e,n.onerror=i,n=null})}var a=this;this.load=l,this.loadCache=n,this.cache={};var r=i.URL||i.webkitURL,s={blobs:{},addBlob:function(o){var e=r.createObjectURL(o),i=Math.random().toString(32).substr(2);return this.blobs[i]={url:e,blob:o},i},addBlobAttr:function(o,e,i){this.blobs[o][e]=i},getBlobById:function(o){var e=this.blobs[o].blob;return e.url=this.blobs[o].url,e},getBlobByURL:function(o){var e=this,i=Object.keys(this.blobs);return function n(t){var l=i[t];if(!l)return null;if(e.blobs[l].url===o){var c=e.blobs[l].blob;return c.url=o,c}return n(++t)}(0)},removeBlobById:function(o){var e=this.blobs[o].url;r.revokeObjectURL(e),delete this.blobs[o]},removeBlobByURL:function(o){this.forEachBlobs(function(e){return e.url===o},function(o,e,i){r.revokeObjectURL(o.url),delete i[e]})},forEachBlobs:function(o,e){var i=this,n=Object.keys(this.blobs);!function t(l){var c=n[l];if(c)return o(i.blobs[c])?e(i.blobs[c],c,i.blobs):t(++l)}(0)}},u={loadImage:function(o,e){var i=null,n=new XMLHttpRequest;n.responseType="arraybuffer",n.open("GET",o,!0),n.onload=function(){var t=new Uint8Array(this.response),l=n.getResponseHeader("Content-Type");l=l?l.split(";")[0]:"image/jpeg";var c=new Blob([t],{type:l});i=s.addBlob(c),s.addBlobAttr(i,"originURL",o),e(null,s.getBlobById(i).url,i)},n.onerror=function(o){return e(o.error)},n.send()},createImage:function(o,e){this.loadImage(o,function(o,i,n){if(console.log(n),console.log(i),o)return e(o);var t=new Image;return t.src=i,e(null,t)})},releaseImage:function(o){s.forEachBlobs(function(e){return e.originURL===o},function(o,e,i){r.revokeObjectURL(o.url),delete i[e]})}}}var t;if(!o)throw new Error("Angular.js is required");e&&(t=e("tuchong-daily:ImageLoader")),o.module("tuchong-daily").service("imageLoader",["UI","$timeout",n])}(window.angular,window.debug,window),function(o,e,i){"use strict";function n(e,n,l,c,a,r,s,u,d,g){function h(o){function e(e){return e.collections?(t&&t("Reading fresh collections (%s)",e.collections.length),f(e.collections,!0),l.save("collections",e.collections),void(o&&o())):c.loading.show('<i class="icon ion-close-circled"></i> 网络连接失败...请稍后再试')}function i(){c.loading.show('<i class="icon ion-close-circled"></i> 网络连接失败...请稍后再试'),o&&o()}l.hot.get({},e,i)}function f(n,t){var l=i.lastSlideIndexHome,c=!l||parseInt(l)<=3;e.collections=t?o.copy(n).splice(0,3):o.copy(n).splice(0,c?3:parseInt(l)+1),u.load(0,e,"home"),a.update()}function m(o){isNaN(o)&&(o=0),t&&t("Switching to slide: [%s]",o),u.load(o,e,"home"),!e.collections[o+1]&&l.cache.collections[o+1]&&e.collections.push(l.cache.collections[o+1]),i.lastSlideIndexHome=o,t&&t("Set lastSlideIndexHome to %s",o),a.update()}function p(o,e){var i=e>1;return i?n.go("collection",{id:o}):(c.loading.show('<i class="icon ion-information-circled"></i> 这个相册只有一张图'),void r(c.loading.hide,400))}return e.go=p,e.share=g.popup,e.updateSlides=m,e.backgrounds=u.loadCache("home"),c.loading.show('<i class="icon ion-refreshing"></i> 努力加载中...'),l.cache.collections?f(l.cache.collections):void h()}var t;if(!o)throw new Error("Angular.js is required");e&&(t=e("tuchong-daily:Controller:Home")),o.module("tuchong-daily").controller("home",["$scope","$state","Store","UI","$ionicSlideBoxDelegate","$timeout","$rootScope","imageLoader","$cordovaDialogs","share",n])}(window.angular,window.debug,window.localStorage),function(o,e,i){"use strict";function n(e,n,t,c,a,r,s,u,d,g){function h(n,t){var l=i.lastSlideIndexCollection,r=!l||parseInt(l)<=3;e.post=n.post,e.images=t?o.copy(n.images).splice(0,3):o.copy(n.images).splice(0,r?3:parseInt(l)+1),s.load(0,e,"collection",a.id),c.update()}function f(o){l&&l("Switching to slide: [%s]",o),s.load(o,e,"collection",a.id),i.lastSlideIndexCollection=o,l&&l("Set lastSlideIndexCollection to %s",o),!e.images[o+1]&&v.images[o+1]&&e.images.push(v.images[o+1]),c.update()}function m(o){var e="right"===o?"toggleRight":"toggleLeft";u[e]()}function p(){var o=i.lastSlideIndexCollection?parseInt(i.lastSlideIndexCollection):0;return e.images&&e.images[o]?void r.go("collection-single",{uri:e.images[o].uri}):(t.loading.show('<i class="icon ion-information-circled"></i> 啊喔，找不到大图了'),void g(t.loading.hide,500))}e.toggle=m,e.share=d.popup,e.viewLarge=p,e.updateSlides=f,e.backgrounds=s.loadCache(a.id);var v=n.findById(a.id);return v?void h(v):void n.post.get({postId:a.id},function(o){l&&l(o),v=o,h(o,!0)},function(o){l&&l(o),r.go("home")})}function t(o,e,i,n){function t(o,e){return e.collectionId?void i.go("collection",{id:e.collectionId}):void n.alert(e.alert,"收到通知","知道了")}return e.uri?(o.uri=e.uri,void o.$on("pushNotificationReceived",t)):i.go("home")}var l;if(!o)throw new Error("Angular.js is required");e&&(l=e("tuchong-daily:Controller:Collection")),o.module("tuchong-daily").controller("collection",["$scope","Store","UI","$ionicSlideBoxDelegate","$stateParams","$state","imageLoader","$ionicSideMenuDelegate","share","$timeout","$cordovaDialogs",n]).controller("collection-single",["$scope","$stateParams","$state","$cordovaDialogs",t])}(window.angular,window.debug,window.localStorage);
//# sourceMappingURL=tuchong.min.js.map